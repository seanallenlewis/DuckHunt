<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">

    <link rel="stylesheet" type="text/css" href="./css/style.css">

    <link href="https://fonts.googleapis.com/css?family=Press+Start+2P" rel="stylesheet">

    <script src="https://code.jquery.com/jquery-3.1.1.min.js"
    integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
    crossorigin="anonymous"></script>

    <title>Duck Hunt</title>
  </head>
  <body>

<!-- SCORE BOARD -->
  <div id="upperBar">
    <div class="score score1">PLAYER 1:
      <div id="player1Score">0</div>
      </div>
    <div id="timeSlot">TIME:
      <div id="timer">00</div>
    </div>
    <div class="score score2">PLAYER 2:
      <div id="player2Score">0</div>
    </div>
  </div>
<!--PLAYING FIELD -->
  <div id="container">
      <div id='welcome'>
        <img id='welcomeImg'src="./images/welcome.jpg" alt="" />
        <h2 id=welcomeText>Click Here To Begin</h2>
      </div>
      <div id='alertBox'>
        <h2 id='alertLine1'></h2>
        <h2 id='alertLine2'></h2>
      </div>
      <div id='resetBox'>
        <h2>WANT TO PLAY AGAIN?</h2>
        <button id="resetButton">RESET</button>
      </div>
<!-- GRASS -->
      <div class="grass" id="grassUpper"><img src="./images/grassUpper.png" alt="" /></div>
      <div class="grass" id="grassLower"><img src="./images/grassLower.png" alt="" /></div>
  </div>

<!-- SOUNDS -->
  <audio id="shotgun" src="audio/shotgun.mp3"></audio>

<script>
  var $shotgun = $('#shotgun')
  var currentPlayer = 1
  var p1Score = 0
  var p2Score = 0
  var continueCode = "x"

  $('html').off('mousedown', playShootingFX)
  $('#alertBox').hide()
  $('#resetBox').hide()

//CLICK TO SHOOT FX
    // $(".container").css("background-color","white")
    // $('body').setTimeout.css("background-color","lightblue"), 100)

  //SHOTGUN SOUND
  $shotgun[0].shoot = function(){
    this.pause()
    this.currentTime = 0
    this.play()
  }

  //SHOTGUN SOUND
  function playShootingFX() {
    $shotgun[0].shoot()
  }

  $('html').off('mousedown', playShootingFX)

//RANDOM NUMBER/POSITION GENERATOR
  function genRandomNum(min, max){
    return (Math.round(Math.random() * (max - min)) + min)
  }
  function randomTop() {
    return genRandomNum(5, ($(window).height() - 100))
  }
  function randomLeft() {
    return genRandomNum(5, ($(window).width() - 50))
  }

//CREATE A DUCK
//create a div with duck image within the field of play and animate
function createDuck(){
  var x = randomTop();
  var y = randomLeft();
  $('#container').append('<div class="duck"><img src="./images/DuckUpWingR.png" alt="" /></div>')
  $('.duck').last().animate({ top: x, left: y }, 600, function duckAnimation() {
    newTop = randomTop();
    newLeft = randomLeft();
      if (newLeft >= y) {
        $(this).html('<img src="./images/DuckUpWingR.png" alt="" />')
      } else if (newLeft < y){
        $(this).html('<img src="./images/DuckUpWingL.png" alt="" />')
      }
    x = newTop
    y = newLeft
    $(this).animate({ top: x, left: y }, 1000, duckAnimation);
  })
  }


//DEAD DUCK
//change img of duck when clicked, animate to drop, increase score
$('body').on('mousedown', '.duck', function(){
  $(this).stop()
  $(this).html('<img src="./images/deadduck.png" alt="" />')
  $(this).animate({top: 650 }, 500, function() {
    $(this).remove()
    createDuck()
  })
  trackScore();
})

//TRACK SCORE
function trackScore(){
  if (currentPlayer == 1) {
    p1Score = p1Score + 1
    $("#player1Score").text(p1Score)
  } else if (currentPlayer == 2){
    p2Score = p2Score + 1
    $("#player2Score").text(p2Score)
  }

}

//WELCOME SCREEN
//initial game screen to start the game
$('#welcome').on('click', function(){
  $('html').off('mousedown', playShootingFX)
  console.log("begin")
  $(this).remove()
  playerReadyWindow()
})

//FUNCTION GOROUTE
//traffic signal to guide into proper functions
function goRoute(){
  console.log("what to do")
  if (continueCode == "x"){
    startTimer()
  } else if (continueCode == "y"){
    switchPlayers()
  } else if (continueCode == "z"){
    stop()
  }
}

//CLOCK FUNCTION
//starts main timer and initialiazes start of turn
function startTimer(){
  console.log("launch timer")
  $('#timer').text('3')
  createDuck()
  createDuck()
  createDuck()
  $('html').on('mousedown', playShootingFX)
  gameTimer = setInterval(goTimer, 1000);}

function goTimer(){
  console.log("start counting")
  var $timerNumber = $('#timer').text()
  if ($timerNumber > 10) {
      $timerNumber = $timerNumber - 1
      $('#timer').text($timerNumber)
  } else if ($timerNumber > 0) {
      $timerNumber = $timerNumber - 1
      $('#timer').text("0" + $timerNumber)
  } else if ($timerNumber == 0) {
      $('.duck').remove()
      $('html').off('mousedown', playShootingFX)
      clearInterval(gameTimer)
      if (continueCode == "x"){
        continueCode = "y"
        goRoute()
      } else if (continueCode == "y"){
        continueCode = "z"
        goRoute()

        return
      }
  }
}

//SWITCH PLAYERS FUNCTION
function switchPlayers(){
  //player 2 notification
  $('.duck').remove()
  console.log("switch Players")
  currentPlayer = 2
  playerReadyWindow()
}

//STOP FUNCTION
function stop(){
  currentPlayer = 0
  $(".score2").css("background-color","white")
  console.log("stop")
  $('.duck').remove()
  WinnerMessage()
}

//PLAYER READY WINDOW FUNCTION
//prompts player to ready and sets score window color
function playerReadyWindow(){
  //greeting for current player
  if (currentPlayer == 1) {
    $('#alertLine1').text(" PLAYER 1, READY? ")
    $(".score1").css("background-color","yellow")
    $(".score2").css("background-color","white")
  } else if (currentPlayer == 2) {
    $('#alertLine1').text(" PLAYER 2, READY? ")
    $(".score1").css("background-color","white")
    $(".score2").css("background-color","yellow")
  }
  //set initial countdown time to 3
  $("#alertLine2").text("3")
  //1 sec interval to countdown from 3 to "go!!!"
  var countDownAlert = setInterval(function(){
    var $count = $('#alertLine2').text()
    if ($count > 1) {
        $count = ($count - 1);
        $('#alertLine2').text(""+$count+"")
    } else {
      $count = "GO!!!";
      $('#alertLine2').text(""+$count+"")
      clearInterval(countDownAlert)
    }
  } , 1000)
  //show alertbox and wait 4 seconds then hide it
  $('#alertBox').show()
  setTimeout(function(){
    $('#alertBox').hide()
    startTimer()
    }, 4000)
    }

// WINNER MESSAGE
function WinnerMessage(){
  console.log("winner message")
  if (p1Score > p2Score) {
    $('#alertLine1').text("    PLAYER 1    ")
    $('#alertLine2').text("    WINS!!!!    ")
  } else if (p1Score < p2Score) {
    $('#alertLine1').text("    PLAYER 2    ")
    $('#alertLine2').text("    WINS!!!!    ")
  } else if (p1Score == p2Score) {
    $('#alertLine1').text("    A TIE!!!    ")
    $('#alertLine2').text("   TRY  AGAIN   ")
  }
  $('#alertBox').show()
  setTimeout(function(){
    $('#alertBox').hide()
    castResetBox()
  }, 5000)
}

//RESET BUTTON
function castResetBox(){
  $('#resetBox').show()
  $("button").mouseup(function(){
      currentPlayer = 1
      p1Score = 0
      p2Score = 0
      continueCode = "x"
    $('#alertBox').hide()
    $('#resetBox').hide()
    playerReadyWindow()
  })
}

</script>



  </body>
</html>
